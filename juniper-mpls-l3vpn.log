Configuration MPLS L3VPN Service Juniper vMX

[Interface Configuration Trunk Node 21-CE]
set interfaces ge-0/0/1 flexible-vlan-tagging
set interfaces ge-0/0/1 mtu 1900
set interfaces ge-0/0/1 encapsulation flexible-ethernet-services
set interfaces ge-0/0/1 unit 20 vlan-id 20
set interfaces ge-0/0/1 unit 20 family inet address 202.100.0.1/30

[Policy VRF Configuration Node 21-CE]
set policy-options policy-statement VPN-AB-EXP term 1 then community add target:65006:20
set policy-options policy-statement VPN-AB-EXP term 1 then accept
set policy-options policy-statement VPN-AB-IMP term 1 from community target:65006:20
set policy-options policy-statement VPN-AB-IMP term 1 then accept
set policy-options policy-statement VPN-AB-IMP term other then reject
set policy-options community target:65006:20 members target:65006:20

[Routing Instance VRF Configuration Node 21-CE]
set routing-instances VPN-AB instance-type vrf
set routing-instances VPN-AB interface ge-0/0/1.20
set routing-instances VPN-AB route-distinguisher 65006:20
set routing-instances VPN-AB vrf-import VPN-AB-IMP
set routing-instances VPN-AB vrf-export VPN-AB-EXP
set routing-instances VPN-AB vrf-table-label

[Interface Configuration Trunk Node 11-CE]
set interfaces ge-0/0/1 flexible-vlan-tagging
set interfaces ge-0/0/1 mtu 1900
set interfaces ge-0/0/1 encapsulation flexible-ethernet-services
set interfaces ge-0/0/1 unit 20 vlan-id 20
set interfaces ge-0/0/1 unit 20 family inet address 202.100.20.1/30

[Policy VRF Configuration Node 11-CE]
set policy-options policy-statement VPN-AB-EXP term 1 then community add target:65006:20
set policy-options policy-statement VPN-AB-EXP term 1 then accept
set policy-options policy-statement VPN-AB-IMP term 1 from community target:65006:20
set policy-options policy-statement VPN-AB-IMP term 1 then accept
set policy-options policy-statement VPN-AB-IMP term other then reject
set policy-options community target:65006:20 members target:65006:20

[Routing Instance VRF Configuration Node 11-CE]
set routing-instances VPN-AB instance-type vrf
set routing-instances VPN-AB interface ge-0/0/1.20
set routing-instances VPN-AB route-distinguisher 65006:20
set routing-instances VPN-AB vrf-import VPN-AB-IMP
set routing-instances VPN-AB vrf-export VPN-AB-EXP
set routing-instances VPN-AB vrf-table-label

[Verification L3VPN Services Node 11-CE]
jncia@11-CE# run show route table VPN-AB.inet.0
VPN-AB.inet.0: 3 destinations, 3 routes (3 active, 0 holddown, 0 hidden)
+ = Active Route, - = Last Active, * = Both
202.100.0.0/30     *[BGP/170] 00:17:08, localpref 100, from 6.6.6.6
                      AS path: I, validation-state: unverified
                    > to 172.0.1.2 via ge-0/0/0.0, Push 16, Push 299840(top)
202.100.20.0/30    *[Direct/0] 00:22:23
                    > via ge-0/0/1.20
202.100.20.1/32    *[Local/0] 00:22:23
                      Local via ge-0/0/1.20
[edit]
jncia@11-CE# run show arp vpn VPN-AB
MAC Address       Address         Name                      Interface           Flags
00:50:79:66:68:24 202.100.20.2    202.100.20.2              ge-0/0/1.20         none
[edit]
jncia@11-CE# run ping 202.100.20.2 routing-instance VPN-AB
PING 202.100.20.2 (202.100.20.2): 56 data bytes
64 bytes from 202.100.20.2: icmp_seq=0 ttl=64 time=6.031 ms
64 bytes from 202.100.20.2: icmp_seq=1 ttl=64 time=3.060 ms
64 bytes from 202.100.20.2: icmp_seq=2 ttl=64 time=2.071 ms
64 bytes from 202.100.20.2: icmp_seq=3 ttl=64 time=2.732 ms
64 bytes from 202.100.20.2: icmp_seq=4 ttl=64 time=2.628 ms
^C
--- 202.100.20.2 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 2.071/3.304/6.031/1.400 ms
[edit]
jncia@11-CE# run ping 202.100.0.2 routing-instance VPN-AB
PING 202.100.0.2 (202.100.0.2): 56 data bytes
64 bytes from 202.100.0.2: icmp_seq=0 ttl=59 time=12.936 ms
64 bytes from 202.100.0.2: icmp_seq=1 ttl=59 time=7.272 ms
64 bytes from 202.100.0.2: icmp_seq=2 ttl=59 time=67.764 ms
64 bytes from 202.100.0.2: icmp_seq=3 ttl=59 time=10.215 ms
64 bytes from 202.100.0.2: icmp_seq=4 ttl=59 time=8.485 ms
^C
--- 202.100.0.2 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 7.272/21.334/67.764/23.293 ms
[edit]
jncia@11-CE#

[Verification L3VPN Services Node 21-CE]
jncia@21-CE# run show route table VPN-AB.inet.0
VPN-AB.inet.0: 3 destinations, 3 routes (3 active, 0 holddown, 0 hidden)
+ = Active Route, - = Last Active, * = Both
202.100.0.0/30     *[Direct/0] 00:13:23
                    > via ge-0/0/1.20
202.100.0.1/32     *[Local/0] 00:13:23
                      Local via ge-0/0/1.20
202.100.20.0/30    *[BGP/170] 00:13:24, localpref 100, from 6.6.6.6
                      AS path: I, validation-state: unverified
                    > to 172.0.5.1 via ge-0/0/0.0, Push 16, Push 299840(top)
[edit]
jncia@21-CE# run show arp vpn VPN-AB
MAC Address       Address         Name                      Interface           Flags
00:50:79:66:68:21 202.100.0.2     202.100.0.2               ge-0/0/1.20         none
[edit]
jncia@21-CE# run ping 202.100.0.2 routing-instance VPN-AB
PING 202.100.0.2 (202.100.0.2): 56 data bytes
64 bytes from 202.100.0.2: icmp_seq=0 ttl=64 time=2.203 ms
64 bytes from 202.100.0.2: icmp_seq=1 ttl=64 time=1.626 ms
64 bytes from 202.100.0.2: icmp_seq=2 ttl=64 time=1.644 ms
64 bytes from 202.100.0.2: icmp_seq=3 ttl=64 time=2.020 ms
64 bytes from 202.100.0.2: icmp_seq=4 ttl=64 time=1.631 ms
64 bytes from 202.100.0.2: icmp_seq=5 ttl=64 time=1.492 ms
^C
--- 202.100.0.2 ping statistics ---
6 packets transmitted, 6 packets received, 0% packet loss
round-trip min/avg/max/stddev = 1.492/1.769/2.203/0.253 ms
[edit]
jncia@21-CE# run ping 202.100.20.2 routing-instance VPN-AB
PING 202.100.20.2 (202.100.20.2): 56 data bytes
64 bytes from 202.100.20.2: icmp_seq=0 ttl=59 time=9.315 ms
64 bytes from 202.100.20.2: icmp_seq=1 ttl=59 time=5.852 ms
64 bytes from 202.100.20.2: icmp_seq=2 ttl=59 time=8.330 ms
64 bytes from 202.100.20.2: icmp_seq=3 ttl=59 time=4.922 ms
64 bytes from 202.100.20.2: icmp_seq=4 ttl=59 time=5.246 ms
64 bytes from 202.100.20.2: icmp_seq=5 ttl=59 time=6.249 ms
^C
--- 202.100.20.2 ping statistics ---
6 packets transmitted, 6 packets received, 0% packet loss
round-trip min/avg/max/stddev = 4.922/6.652/9.315/1.617 ms
[edit]
jncia@21-CE#

[Verification Node-A]
NODE-A> show ip
NAME        : NODE-A[1]
IP/MASK     : 202.100.0.2/30
GATEWAY     : 202.100.0.1
DNS         :
MAC         : 00:50:79:66:68:21
LPORT       : 20000
RHOST:PORT  : 127.0.0.1:30000
MTU         : 1500
NODE-A> ping 202.100.20.2
84 bytes from 202.100.20.2 icmp_seq=1 ttl=58 time=24.227 ms
84 bytes from 202.100.20.2 icmp_seq=2 ttl=58 time=12.055 ms
84 bytes from 202.100.20.2 icmp_seq=3 ttl=58 time=17.800 ms
84 bytes from 202.100.20.2 icmp_seq=4 ttl=58 time=23.089 ms
84 bytes from 202.100.20.2 icmp_seq=5 ttl=58 time=12.775 ms
NODE-A> trace 202.100.20.2
trace to 202.100.20.2, 8 hops max, press Ctrl+C to stop
 1   202.100.0.1   5.965 ms  3.140 ms  3.973 ms
 2     *  *  *
 3     *  *  *
 4     *  *  *
 5     *  *  *
 6   202.100.20.1   14.421 ms  13.858 ms  12.744 ms
 7   *202.100.20.2   14.217 ms (ICMP type:3, code:3, Destination port unreachable)
NODE-A>

[Verification Node-B]
NODE-B> show ip
NAME        : NODE-B[1]
IP/MASK     : 202.100.20.2/30
GATEWAY     : 202.100.20.1
DNS         :
MAC         : 00:50:79:66:68:24
LPORT       : 20000
RHOST:PORT  : 127.0.0.1:30000
MTU         : 1500
NODE-B> ping 202.100.0.2
84 bytes from 202.100.0.2 icmp_seq=1 ttl=58 time=13.901 ms
84 bytes from 202.100.0.2 icmp_seq=2 ttl=58 time=15.014 ms
84 bytes from 202.100.0.2 icmp_seq=3 ttl=58 time=15.417 ms
84 bytes from 202.100.0.2 icmp_seq=4 ttl=58 time=13.328 ms
84 bytes from 202.100.0.2 icmp_seq=5 ttl=58 time=14.723 ms
NODE-B> trace 202.100.0.2
trace to 202.100.0.2, 8 hops max, press Ctrl+C to stop
 1   202.100.20.1   4.786 ms  2.894 ms  3.641 ms
 2     *  *  *
 3     *  *  *
 4     *  *  *
 5     *  *  *
 6   202.100.0.1   10.128 ms  10.232 ms  11.734 ms
 7   *202.100.0.2   12.253 ms (ICMP type:3, code:3, Destination port unreachable)
NODE-B>



